# PPTæ™ºèƒ½ç”Ÿæˆç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºæ¨¡æ¿çš„PPTæ™ºèƒ½ç”Ÿæˆç³»ç»Ÿï¼Œä¸“ä¸ºæˆ¿åœ°äº§æ•°æ®åˆ†æè®¾è®¡ã€‚ç³»ç»Ÿæ”¯æŒé€šè¿‡é…ç½®åŒ–çš„æ¨¡æ¿å’ŒåŠ¨æ€æ•°æ®æ¥ç”Ÿæˆä¸“ä¸šçš„PPTå¹»ç¯ç‰‡ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **æ¨¡æ¿é©±åŠ¨**: é€šè¿‡YAMLé…ç½®å®šä¹‰PPTæ¨¡æ¿ï¼Œæ”¯æŒçµæ´»çš„ç‰ˆå¼é€‰æ‹©
- **åŠ¨æ€æ–‡æœ¬**: ä½¿ç”¨Jinja2æ¨¡æ¿å¼•æ“æ”¯æŒå˜é‡æ›¿æ¢å’Œæ–‡æ¡ˆå˜ä½“
- **å¤šç‰ˆå¼æ”¯æŒ**: æ”¯æŒ5ç§æ ‡å‡†ç‰ˆå¼ï¼ˆå•æ /åŒæ å›¾è¡¨ã€è¡¨æ ¼ç­‰ï¼‰
- **æ•°æ®åˆ†ç¦»**: æ”¯æŒCSVç­‰å¤–éƒ¨æ•°æ®æºï¼Œå®ç°æ•°æ®ä¸é€»è¾‘åˆ†ç¦»
- **å¯æ‰©å±•æ¶æ„**: æ¸…æ™°çš„å››å±‚æ¶æ„è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å››å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å±•ç¤ºå±‚ (Presentation)                    â”‚
â”‚                  test_new_system.py, å¿«é€Ÿç”Ÿæˆè„šæœ¬             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚ (Business)                      â”‚
â”‚                     ppt_engine.py                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚ (Service)                         â”‚
â”‚          template_system/ + data_manager/ + rendering/    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                â”‚
â”‚                  core/ + ç¬¬ä¸‰æ–¹åº“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ¨¡å— | èŒè´£ | å…³é”®æ–‡ä»¶ |
|------|------|----------|
| **core/** | PPTåŸºç¡€æ“ä½œ | `ppt_operations.py`, `ppt_schemas.py` |
| **template_system/** | æ¨¡æ¿ç³»ç»Ÿ | `catalog.py`, `builder.py`, `text_manager.py` |
| **data_manager/** | æ•°æ®ç®¡ç† | `context.py` |
| **rendering/** | æ¸²æŸ“ç³»ç»Ÿ | `slide_renderers.py` |
| **ppt_engine.py** | ç”Ÿæˆå¼•æ“ | ç»Ÿä¸€çš„PPTç”Ÿæˆæ¥å£ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ä¾èµ–åŒ…è§ `pyproject.toml`

### å®‰è£…ä¾èµ–

```bash
uv sync
```

### å¿«é€Ÿæµ‹è¯•

```bash
# è¿è¡ŒåŸºæœ¬æµ‹è¯•
uv run python test_new_system.py

# æ£€æŸ¥ç”Ÿæˆçš„PPTæ–‡ä»¶
ls output/
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
PPTReviewer/
â”œâ”€â”€ core/                          # PPTåŸºç¡€æ“ä½œå±‚
â”‚   â”œâ”€â”€ ppt_operations.py          # PPTæ–‡ä»¶æ“ä½œ
â”‚   â””â”€â”€ ppt_schemas.py             # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ template_system/               # æ¨¡æ¿ç³»ç»Ÿ
â”‚   â”œâ”€â”€ catalog.py                 # æ¨¡æ¿ç›®å½•å’ŒåŠ è½½
â”‚   â”œâ”€â”€ builder.py                 # å¹»ç¯ç‰‡é…ç½®æ„å»ºå™¨
â”‚   â””â”€â”€ text_manager.py            # æ–‡æœ¬æ¨¡æ¿ç®¡ç†
â”œâ”€â”€ data_manager/                  # æ•°æ®ç®¡ç†å±‚
â”‚   â””â”€â”€ context.py                 # æ•°æ®ä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ rendering/                     # æ¸²æŸ“å±‚
â”‚   â””â”€â”€ slide_renderers.py        # å¹»ç¯ç‰‡æ¸²æŸ“å™¨
â”œâ”€â”€ resources/templates/            # æ¨¡æ¿é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ template_definitions.yaml  # æ¨¡æ¿å®šä¹‰
â”œâ”€â”€ template_system/text_pattern.yaml # æ–‡æœ¬æ¨¡æ¿
â”œâ”€â”€ output/                        # ç”Ÿæˆçš„PPTæ–‡ä»¶
â”œâ”€â”€ BeijingLiangxiang_slide1_chart1.csv # ç¤ºä¾‹æ•°æ®æ–‡ä»¶
â”œâ”€â”€ test_new_system.py             # æµ‹è¯•è„šæœ¬
â””â”€â”€ ppt_engine.py                  # ç»Ÿä¸€ç”Ÿæˆå¼•æ“
```

## ğŸ”§ é…ç½®ç³»ç»Ÿè¯¦è§£

### 1. æ¨¡æ¿å®šä¹‰ (`resources/templates/template_definitions.yaml`)

å®šä¹‰æ¯ä¸ªPPTæ¨¡æ¿çš„åŸºæœ¬ä¿¡æ¯ï¼š

```yaml
- uid: "T01_Supply_Trans_Bar"
  # å…³è”æ–‡æ¡ˆ (æŒ‡å‘ text_patterns.yaml)
  theme_key: "Block Area Segment Distribution"
  function_key: "Supply-Transaction Unit Statistic"
  # æ ¸å¿ƒè§£è€¦ï¼šåœ¨è¿™é‡Œé€‰æ‹©ç‰ˆå¼ï¼
  layout_type: "single_column_bar"
  summary_item: 1
  # æ•°æ®æ˜ å°„
  data_keys:
    chart_main: "supply_trans_data"
```

**å­—æ®µè¯´æ˜**ï¼š
- `uid`: æ¨¡æ¿å”¯ä¸€æ ‡è¯†ç¬¦
- `theme_key`: ä¸»é¢˜åç§°ï¼Œå¯¹åº”`text_pattern.yaml`
- `function_key`: åŠŸèƒ½åç§°ï¼Œå¯¹åº”`text_pattern.yaml`
- `layout_type`: ç‰ˆå¼ç±»å‹ï¼Œå¯é€‰å€¼ï¼š
  - `single_column_bar`: å•æ æŸ±çŠ¶å›¾
  - `single_column_line`: å•æ æŠ˜çº¿å›¾
  - `double_column_bar`: åŒæ æŸ±çŠ¶å›¾
  - `double_column_line`: åŒæ æŠ˜çº¿å›¾
  - `single_column_table`: å•æ è¡¨æ ¼
- `summary_item`: æ–‡æ¡ˆå˜ä½“ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
- `data_keys`: æ•°æ®æ˜ å°„ï¼Œå…³è”æ•°æ®æº

### 2. æ–‡æ¡ˆæ¨¡æ¿ (`template_system/text_pattern.yaml`)

å®šä¹‰åŠ¨æ€æ–‡æœ¬æ¨¡æ¿ï¼Œæ”¯æŒJinja2å˜é‡æ›¿æ¢ï¼š

```yaml
# ==============================================================================
# Theme: Block Area Segment Distribution
# ==============================================================================
"Block Area Segment Distribution":
  "Supply-Transaction Unit Statistic":
    title: >-
      **{{ Temporal_Start_Year }}** - **{{ Temporal_End_Year }}** Supply and Transaction Unit Statistics in **{{ Geo_City_Name }}**'s **{{ Geo_Block_Name }}**
    summaries:
      - >-
        From **{{ Temporal_Start_Year }}** to **{{ Temporal_End_Year }}**, **{{ Geo_Block_Name }}**'s core supply-demand area was **{{ Seg_SupplyDemand_Core_Area }}** mÂ²...
      - >-
        Between **{{ Temporal_Start_Year }}** and **{{ Temporal_End_Year }}**, the market structure in **{{ Geo_Block_Name }}**...
      - >-
        The **{{ Geo_Block_Name }}** sector exhibited a dual-tier segmentation...
```

**å˜é‡è¯´æ˜**ï¼š
- `Temporal_Start_Year/Temporal_End_Year`: èµ·æ­¢å¹´ä»½
- `Geo_City_Name`: åŸå¸‚åç§°
- `Geo_Block_Name`: æ¿å—åç§°
- `Seg_SupplyDemand_Core_Area`: æ ¸å¿ƒä¾›éœ€é¢ç§¯
- å…¶ä»–å˜é‡æ ¹æ®å…·ä½“ä¸»é¢˜å®šä¹‰

### 3. æ•°æ®æ–‡ä»¶æ ¼å¼

æ”¯æŒCSVæ ¼å¼çš„æ•°æ®æ–‡ä»¶ï¼Œæ ‡å‡†æ ¼å¼ï¼š

```csv
ç±»åˆ«,supply_counts,trade_counts
0-20mÂ²,548.0,209.0
20-40mÂ²,137.0,29.0
40-60mÂ²,195.0,44.0
60-80mÂ²,682.0,428.0
80-100mÂ²,1891.0,2040.0
```

**æ•°æ®è§„èŒƒ**ï¼š
- ç¬¬ä¸€åˆ—ä¸ºç±»åˆ«æ ‡ç­¾ï¼ˆç”¨äºå›¾è¡¨Xè½´ï¼‰
- åç»­åˆ—ä¸ºæ•°æ®ç³»åˆ—ï¼ˆç”¨äºå›¾ä¾‹ï¼‰
- æ•°æ®ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºé€‚åˆPPTå›¾è¡¨çš„æ ¼å¼

## ğŸ’» ä½¿ç”¨æ–¹å¼

### 1. åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

```python
from ppt_engine import PPTGenerationEngine, PPTDataHelper
import pandas as pd

# 1. åŠ è½½æ•°æ®
df = pd.read_csv("BeijingLiangxiang_slide1_chart1.csv")
df = df.set_index(df.columns[0])  # è®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•

# 2. å‡†å¤‡ä¸Šä¸‹æ–‡
context = PPTDataHelper.create_context()
context.add_dataset("supply_trans_data", df)

# 3. æ·»åŠ å˜é‡
context.add_variable("Temporal_Start_Year", "2023")
context.add_variable("Temporal_End_Year", "2024")
context.add_variable("Geo_City_Name", "åŒ—äº¬")
context.add_variable("Geo_Block_Name", "è‰¯ä¹¡")

# 4. ç”ŸæˆPPT
engine = PPTGenerationEngine("output/example.pptx")
engine.generate_single_slide("T01_Supply_Trans_Bar", context)
```

### 2. è‡ªå®šä¹‰æ¨¡æ¿ç¤ºä¾‹

#### æ·»åŠ æ–°æ¨¡æ¿

åœ¨ `resources/templates/template_definitions.yaml` ä¸­æ·»åŠ ï¼š

```yaml
- uid: "T02_Price_Trend_Line"
  theme_key: "New-House Market Capacity Analysis"
  function_key: "Annual Supply-Demand Comparison"
  layout_type: "single_column_line"
  summary_item: 0
  data_keys:
    chart_main: "price_data"
```

#### æ·»åŠ æ–°æ–‡æ¡ˆ

åœ¨ `template_system/text_pattern.yaml` ä¸­æ·»åŠ ï¼š

```yaml
"New-House Market Capacity Analysis":
  "Annual Supply-Demand Comparison":
    title: >-
      **{{ Geo_City_Name }}** **{{ Geo_Block_Name }}** Annual Supply-Demand Comparison Analysis (**{{ Temporal_Start_Year }}**-**{{ Temporal_End_Year }}**)
    summaries:
      - >-
        From **{{ Temporal_Start_Year }}** to **{{ Temporal_End_Year }}**, new listings **{{ Trend_Trajectory_Type }}**...
```

### 3. å¤šæ¨¡æ¿ç”Ÿæˆ

```python
# å®šä¹‰å¤šä¸ªæ¨¡æ¿é…ç½®
template_configs = [
    {
        "template_id": "T01_Supply_Trans_Bar",
        "context": context
    },
    {
        "template_id": "T02_Price_Trend_Line",
        "context": context
    }
]

# ç”Ÿæˆå¤šé¡µPPT
engine.generate_multiple_slides(template_configs)
```

## ğŸ” ç‰ˆå¼ç±»å‹è¯¦è§£

### æ”¯æŒçš„ç‰ˆå¼

| ç‰ˆå¼ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ | æ•°æ®éœ€æ±‚ |
|----------|------|----------|----------|
| `single_column_bar` | å•æ æŸ±çŠ¶å›¾ | å•ä¸€æ•°æ®ç³»åˆ—å¯¹æ¯” | 2-5ä¸ªç³»åˆ— |
| `single_column_line` | å•æ æŠ˜çº¿å›¾ | è¶‹åŠ¿åˆ†æ | 1-3ä¸ªç³»åˆ— |
| `double_column_bar` | åŒæ æŸ±çŠ¶å›¾ | åŒæŒ‡æ ‡å¯¹æ¯” | å·¦å³å„2-3ä¸ªç³»åˆ— |
| double_column_line | åŒæ æŠ˜çº¿å›¾ | åŒè¶‹åŠ¿å¯¹æ¯” | å·¦å³å„1-2ä¸ªç³»åˆ— |
| `single_column_table` | å•æ è¡¨æ ¼ | è¯¦ç»†æ•°æ®å±•ç¤º | ç»“æ„åŒ–æ•°æ® |

### ç‰ˆå¼å‚æ•°

æ¯ç§ç‰ˆå¼éƒ½æœ‰ä¼˜åŒ–çš„æ¸²æŸ“å‚æ•°ï¼š

```python
# å•æ æŸ±çŠ¶å›¾ç¤ºä¾‹
{
    "font_size": 11,           # å­—ä½“å¤§å°
    "has_legend": True,        # æ˜¾ç¤ºå›¾ä¾‹
    "has_data_labels": True,  # æ˜¾ç¤ºæ•°å€¼æ ‡ç­¾
    "gap_width": 150,         # æŸ±é—´è·å®½åº¦
    "y_axis_visible": False   # Yè½´å¯è§æ€§
}
```

## ğŸ¨ è‡ªå®šä¹‰ä¸æ‰©å±•

### 1. æ·»åŠ æ–°ç‰ˆå¼

1. åœ¨ `rendering/slide_renderers.py` ä¸­åˆ›å»ºæ–°çš„æ¸²æŸ“å™¨ç±»
2. ç»§æ‰¿ `BaseSlideRenderer` å¹¶å®ç°ç›¸åº”æ–¹æ³•
3. åœ¨ `RendererFactory.get_renderer()` ä¸­æ³¨å†Œæ–°ç‰ˆå¼

### 2. æ‰©å±•æ•°æ®ç±»å‹

```python
# è‡ªå®šä¹‰æ•°æ®åŠ è½½
def load_custom_data():
    df = pd.read_excel("data.xlsx", sheet_name="Sheet1")
    df = df.set_index("ç±»åˆ«")
    return df

# æ·»åŠ åˆ°ä¸Šä¸‹æ–‡
context.add_dataset("custom_data", load_custom_data())
```

### 3. è‡ªå®šä¹‰æ–‡æœ¬æ¨¡æ¿

ä½¿ç”¨Jinja2çš„é«˜çº§åŠŸèƒ½ï¼š

```yaml
"Custom Theme":
  "Custom Function":
    title: >-
      {% if market_type == "resale" %}
        äºŒæ‰‹æˆ¿{{ metric_type }}åˆ†æ
      {% else %}
        æ–°æˆ¿{{ metric_type}}åˆ†æ
      {% endif %}
    summaries:
      - >-
        {% if trend_direction == "up" %}
          å¸‚åœºå‘ˆç°{{ adjective }}ä¸Šæ¶¨è¶‹åŠ¿
        {% else %}
          å¸‚åœºå‘ˆç°{{ adjective }}ä¸‹è·Œè¶‹åŠ¿
        {% endif %}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡æ¿æœªæ‰¾åˆ°**
   - æ£€æŸ¥ `template_definitions.yaml` ä¸­æ˜¯å¦å®šä¹‰äº†å¯¹åº”æ¨¡æ¿
   - ç¡®è®¤æ¨¡æ¿IDæ‹¼å†™æ­£ç¡®

2. **æ•°æ®ç¼ºå¤±**
   - æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤ `data_keys` ä¸­çš„æ•°æ®é”®åä¸ä¸Šä¸‹æ–‡ä¸€è‡´

3. **å˜é‡æœªæ›¿æ¢**
   - æ£€æŸ¥ `text_pattern.yaml` ä¸­å˜é‡åæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ä¸Šä¸‹æ–‡ä¸­æ·»åŠ äº†æ‰€æœ‰å¿…éœ€å˜é‡

4. **PPTç”Ÿæˆå¤±è´¥**
   - æ£€æŸ¥è¾“å‡ºç›®å½•æ˜¯å¦æœ‰å†™å…¥æƒé™
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### è°ƒè¯•æŠ€å·§

```python
# 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# 2. éªŒè¯æ¨¡æ¿
engine = PPTGenerationEngine("test.pptx")
if engine.validate_template_data("T01_Supply_Trans_Bar", context):
    print("æ¨¡æ¿éªŒè¯é€šè¿‡")

# 3. æŸ¥çœ‹æ¨¡æ¿ä¿¡æ¯
info = engine.get_template_info()
print(f"å¯ç”¨æ¨¡æ¿: {info['template_list']}")
```

## ğŸ“Š è¿è¡Œé€»è¾‘è¯¦è§£

### å®Œæ•´çš„PPTç”Ÿæˆæµç¨‹

```mermaid
graph TD
    A[å¼€å§‹] --> B[åŠ è½½æ¨¡æ¿å®šä¹‰]
    B --> C[åŠ è½½æ–‡æœ¬æ¨¡æ¿]
    C --> D[åŠ è½½CSVæ•°æ®]
    D --> E[åˆ›å»ºæ•°æ®ä¸Šä¸‹æ–‡]
    E --> F[æ·»åŠ æ•°æ®åˆ°ä¸Šä¸‹æ–‡]
    F --> G[æ·»åŠ å˜é‡åˆ°ä¸Šä¸‹æ–‡]
    G --> H[æ„å»ºå¹»ç¯ç‰‡é…ç½®]
    H --> I[é€‰æ‹©æ¸²æŸ“å™¨]
    I --> J[æ¸²æŸ“PPTå…ƒç´ ]
    J --> K[ä¿å­˜PPTæ–‡ä»¶]
    K --> L[å®Œæˆ]
```

### è¯¦ç»†æ‰§è¡Œæ­¥éª¤

1. **åˆå§‹åŒ–é˜¶æ®µ**
   ```python
   # è‡ªåŠ¨åŠ è½½æ¨¡æ¿å®šä¹‰
   load_templates()  # catalog.py
   text_manager = TextTemplateManager("template_system/text_pattern.yaml")
   ```

2. **æ•°æ®å‡†å¤‡é˜¶æ®µ**
   ```python
   # è¯»å–CSVå¹¶å¤„ç†æ•°æ®æ ¼å¼
   df = pd.read_csv("data.csv")
   df = df.set_index(df.columns[0])  # è®¾ç½®ç±»åˆ«åˆ—ä¸ºç´¢å¼•

   # åˆ›å»ºæ•°æ®ä¸Šä¸‹æ–‡
   context = PresentationContext()
   context.add_dataset("data_key", df)
   context.add_variable("var_name", "value")
   ```

3. **é…ç½®æ„å»ºé˜¶æ®µ**
   ```python
   # SlideConfigBuilder.build()
   builder = SlideConfigBuilder()
   slide_config = builder.build(template_id, context)
   ```

4. **æ¸²æŸ“æ‰§è¡Œé˜¶æ®µ**
   ```python
   # æ ¹æ®ç‰ˆå¼é€‰æ‹©æ¸²æŸ“å™¨
   renderer = RendererFactory.get_renderer(layout_type, ppt_ops)
   renderer.render(slide_config["template_slide"], page_number=1)
   ```

### æ ¸å¿ƒç±»äº¤äº’å…³ç³»

```python
# PPTGenerationEngine (åè°ƒå™¨)
class PPTGenerationEngine:
    def __init__(self):
        self.slide_config_builder = SlideConfigBuilder()

    def generate_single_slide(self, template_id, context):
        # æ„å»ºé…ç½®
        slide_config = self.slide_config_builder.build(template_id, context)

        # è·å–æ¸²æŸ“å™¨
        layout_type = slide_config["layout_type"]
        renderer = RendererFactory.get_renderer(layout_type, ppt_operations)

        # æ‰§è¡Œæ¸²æŸ“
        renderer.render(slide_config["template_slide"], page_number=1)

# SlideConfigBuilder (é…ç½®æ„å»ºå™¨)
class SlideConfigBuilder:
    def build(self, template_id, context):
        # è·å–æ¨¡æ¿å…ƒæ•°æ®
        template = get_template_by_id(template_id)

        # æ¸²æŸ“æ–‡æœ¬
        title = text_manager.render(theme.theme_key, theme.function_key, 'title', context.variables)
        summary = text_manager.render(theme.theme_key, theme.function_key, 'summary', context.variables, template.summary_item)

        # æ³¨å…¥æ•°æ®å…ƒç´ 
        elements = self._inject_data_elements(template, context)

        return {"layout_type": template.layout_type, "template_slide": {"elements": elements}}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®å¤„ç†ä¼˜åŒ–

```python
# ç¼“å­˜æœºåˆ¶
from functools import lru_cache
import pandas as pd

@lru_cache(maxsize=5)
def load_data_with_cache(file_path: str) -> pd.DataFrame:
    """å¸¦ç¼“å­˜çš„æ•°æ®åŠ è½½"""
    return pd.read_csv(file_path)

# å¤§æ•°æ®é›†å¤„ç†
def preprocess_large_dataset(file_path: str) -> pd.DataFrame:
    """é¢„å¤„ç†å¤§æ•°æ®é›†"""
    # åªè¯»å–éœ€è¦çš„åˆ—
    usecols = ['ç±»åˆ«', 'ä¾›åº”å¥—æ•°', 'æˆäº¤å¥—æ•°']
    dtypes = {'ç±»åˆ«': 'str', 'ä¾›åº”å¥—æ•°': 'float32', 'æˆäº¤å¥—æ•°': 'float32'}

    df = pd.read_csv(file_path, usecols=usecols, dtype=dtypes)

    # æ•°æ®èšåˆå’Œæ¸…ç†
    df = df.groupby('ç±»åˆ«', as_index=False).sum()

    return df
```

### 2. å†…å­˜ç®¡ç†

```python
import gc

class MemoryEfficientGenerator:
    def __init__(self):
        self.context_cache = {}

    def generate_with_cleanup(self, template_configs):
        """å†…å­˜ä¼˜åŒ–çš„æ‰¹é‡ç”Ÿæˆ"""
        for config in template_configs:
            try:
                # ä½¿ç”¨ç‹¬ç«‹å®ä¾‹ï¼Œé¿å…å†…å­˜ç´¯ç§¯
                engine = PPTGenerationEngine(f"output/{config['name']}.pptx")
                engine.generate_single_slide(config['template_id'], config['context'])

                # æ¸…ç†ä¸éœ€è¦çš„ä¸Šä¸‹æ–‡å¼•ç”¨
                if config['name'] in self.context_cache:
                    del self.context_cache[config['name']]

            except Exception as e:
                logger.error(f"ç”Ÿæˆå¤±è´¥: {e}")

            # å¼ºåˆ¶åƒåœ¾å›æ”¶
            gc.collect()
```

### 3. å¹¶å‘å¤„ç†

```python
import concurrent.futures
from typing import List, Dict

class ConcurrentPPTGenerator:
    def __init__(self, max_workers: int = 4):
        self.max_workers = max_workers

    def generate_parallel(self, template_configs: List[Dict]) -> List[str]:
        """å¹¶è¡Œç”ŸæˆPPT"""
        success_files = []
        failed_configs = []

        with concurrent.futures.ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            # æäº¤æ‰€æœ‰ä»»åŠ¡
            future_to_config = {
                executor.submit(self._generate_single, config): config
                for config in template_configs
            }

            # æ”¶é›†ç»“æœ
            for future in concurrent.futures.as_completed(future_to_config):
                config = future_to_config[future]
                try:
                    output_file = future.result()
                    success_files.append(output_file)
                except Exception as e:
                    failed_configs.append((config, e))

        logger.info(f"æˆåŠŸ: {len(success_files)}, å¤±è´¥: {len(failed_configs)}")
        return success_files
```

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### è¯¦ç»†æ—¥å¿—é…ç½®

```python
import logging
from pathlib import Path

def setup_logging():
    """é…ç½®è¯¦ç»†æ—¥å¿—"""
    log_dir = Path("logs")
    log_dir.mkdir(exist_ok=True)

    # é…ç½®æ ¹æ—¥å¿—å™¨
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler(log_dir / "ppt_generator.log", encoding='utf-8'),
            logging.StreamHandler()
        ]
    )

    # é…ç½®ç¬¬ä¸‰æ–¹åº“æ—¥å¿—
    logging.getLogger("pptx").setLevel(logging.WARNING)
    logging.getLogger("pandas").setLevel(logging.INFO)
    logging.getLogger("matplotlib").setLevel(logging.WARNING)
```

### æ€§èƒ½ç›‘æ§

```python
import time
from functools import wraps

def performance_monitor(func):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        try:
            result = func(*args, **kwargs)
            end_time = time.time()
            logger.info(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end_time - start_time:.2f}ç§’")
            return result
        except Exception as e:
            end_time = time.time()
            logger.error(f"{func.__name__} æ‰§è¡Œå¤±è´¥ï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’ï¼Œé”™è¯¯: {e}")
            raise
    return wrapper

# ä½¿ç”¨ç¤ºä¾‹
@performance_monitor
def generate_ppt_with_monitoring(template_id: str, context: PresentationContext):
    engine = PPTGenerationEngine("output/monitored.pptx")
    engine.generate_single_slide(template_id, context)
```

## ğŸ“š æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ•°æ®æº

```python
# æ–°å¢Excelæ•°æ®æ”¯æŒ
def add_excel_support():
    """æ·»åŠ Excelæ•°æ®æ”¯æŒ"""
    import pandas as pd

    def load_excel_data(file_path: str, sheet_name: str = None) -> pd.DataFrame:
        df = pd.read_excel(file_path, sheet_name=sheet_name)
        return df

    # æ›¿æ¢CSVåŠ è½½å™¨
    PPTDataHelper.load_excel_data = load_excel_data

# ä½¿ç”¨ç¤ºä¾‹
context = PPTDataHelper.create_context()
excel_data = context.add_excel_data("data.xlsx", "Sheet1")
```

### æ·»åŠ æ–°çš„å›¾è¡¨ç±»å‹

```python
# åœ¨rendering/slide_renderers.pyä¸­æ·»åŠ 
class PieChartRenderer(BaseSlideRenderer):
    """é¥¼å›¾æ¸²æŸ“å™¨"""

    def _render_chart(self, page_number: int, element: Dict[str, Any]) -> None:
        """æ¸²æŸ“é¥¼å›¾"""
        # å®ç°é¥¼å›¾æ¸²æŸ“é€»è¾‘
        pass

# åœ¨RendererFactoryä¸­æ³¨å†Œ
def get_renderer(layout_type: str, ppt_operations: PPTOperations) -> BaseSlideRenderer:
    renderer_mapping = {
        "single_column_bar": SingleColumnBarRenderer,
        # ... å…¶ä»–æ¸²æŸ“å™¨
        "single_column_pie": PieChartRenderer,  # æ–°å¢
    }
    return renderer_mapping.get(layout_type, BaseSlideRenderer(ppt_operations))
```

---

**ğŸ‰ è¿™ä¸ªPPTæ™ºèƒ½ç”Ÿæˆç³»ç»Ÿä¸ºæ‚¨çš„æ•°æ®åˆ†æå·¥ä½œæä¾›ä¸“ä¸šã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼**
